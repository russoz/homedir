#!/bin/bash -e 'echo Do not run this >&2; exit 1'
#
# $Id$
#
# Alexei Znamensky <alexei.znamensky@cognizant.com>
#
# Feel free to send suggestions, comments. Flames go to /dev/null.
#

##############################################################################

make_ssh_aliases() {
  for _s in "$@"; do
    _b=$(echo $_s|sed -e 's/\..*$//')
    [ -z "$_b" ] && { echo "Cannot figure alias for $_s" >&2; continue; }
 
    eval "alias $_b='ssh $_s'" || {
      echo "Error making alias ($_b='ssh $_s')" >&2
    }
  done
}

make_foreach_func() {
  _n="$1"; shift
  
  [ -n "$_n" ] || {
    echo "usage: make_foreach_func <func-name> <host-list ...>" >&2
    return 1
  }
   
  eval \
    ${_n}'()' '{ for s in ' $@ '; do
        echo "=========================== $s"
        ssh "$s" "$@"
      done
    }' || { echo "Cannot define func ${_n}()!" >&2; return 1; }
}

##############################################################################
#
#  BR AIX
#

#  spoaixweb1.brazil.avon.com
#  spoaxclor2.brazil.avon.com

BR_AIX_PROD_SERVERS="
  spoaxapp3.brazil.avon.com
  spoaxapp4.brazil.avon.com
  spoaxbkp1.brazil.avon.com
  spoaxclap1.brazil.avon.com
  spoaxclap2.brazil.avon.com
  spoaxclor1.brazil.avon.com

  spoaxor3.brazil.avon.com
  spoaxor4.brazil.avon.com
  spoaxor5.brazil.avon.com
  spoaxor6.brazil.avon.com"
make_foreach_func br-aix-prod-foreach-server $BR_AIX_PROD_SERVERS
make_ssh_aliases                             $BR_AIX_PROD_SERVERS

br-aix-prod-install-rpm() {
  br-aix-prod-foreach-server -t -- sudo rpm -Uvh "$@"
}

BR_AIX_QA_SERVERS="
  spoaxdevapp.brazil.avon.com
  spoaxqaor1.brazil.avon.com
  spoaxqaor2.brazil.avon.com
  spoaxqapeople.brazil.avon.com"
make_foreach_func br-aix-qa-foreach-server $BR_AIX_QA_SERVERS
make_ssh_aliases                           $BR_AIX_QA_SERVERS
alias spoaxqa="spoaxdevapp"

br-aix-qa-install-rpm() {
  br-aix-qa-foreach-server -t -- sudo rpm -Uvh "$@"
}

BR_AIX_DEV_SERVERS="
  spoaxdev.brazil.avon.com
  spoaxdevor1.brazil.avon.com
  spoaxdevpeople.brazil.avon.com"
make_foreach_func br-aix-dev-foreach-server $BR_AIX_DEV_SERVERS
make_ssh_aliases                            $BR_AIX_DEV_SERVERS

br-aix-dev-install-rpm() {
  br-aix-dev-foreach-server -t -- sudo rpm -Uvh "$@"
}

BR_AIX_SERVERS="$BR_AIX_DEV_SERVERS $BR_AIX_QA_SERVERS $BR_AIX_PROD_SERVERS"
make_foreach_func br-aix-foreach-server $BR_AIX_SERVERS

br-aix-install-rpm() {
  br-aix-foreach-server -t -- sudo rpm -Uvh "$@"
}

##############################################################################
#
#  BR SUN
#

BR_SUN_SERVERS="sposunap1.brazil.avon.com
  sposunor1.brazil.avon.com
  sposunor2.brazil.avon.com
  sposundev.brazil.avon.com"

#br-sun-foreach-server() {
#  for s in $BR_SUN_SERVERS; do
#    echo "=========================== $s"
#    /usr/bin/ssh "$s" "$@"
#  done
#}

alias sposunap1="telnet sposunap1.brazil.avon.com"
alias sposunor1="telnet sposunor1.brazil.avon.com"
alias sposunor2="ssh sposunor2.brazil.avon.com"
alias sposundev="telnet sposundev.brazil.avon.com"

##############################################################################
#
#  BR LINUX
#

#BR_LINUX_DEV_SERVERS=""
#make_foreach_func br-linux-dev-foreach-server $BR_LINUX_DEV_SERVERS
#make_ssh_aliases                              $BR_LINUX_DEV_SERVERS

BR_LINUX_QA_SERVERS="spolxqdst.sa.avonet.net"
make_foreach_func br-linux-qa-foreach-server $BR_LINUX_QA_SERVERS
make_ssh_aliases                             $BR_LINUX_QA_SERVERS

BR_LINUX_PROD_SERVERS="spolxpmon.sa.avonet.net
  spolxpdst.sa.avonet.net
  spolxlgto.sa.avonet.net"
make_foreach_func br-linux-prod-foreach-server $BR_LINUX_PROD_SERVERS
make_ssh_aliases                               $BR_LINUX_PROD_SERVERS

BR_LINUX_SERVERS="
  $BR_LINUX_DEV_SERVERS
  $BR_LINUX_QA_SERVERS
  $BR_LINUX_PROD_SERVERS"
make_foreach_func br-linux-foreach-server $BR_LINUX_SERVERS

##############################################################################
#
#  RYE AIX
#

RYE_AIX_DEV_SERVERS="
  ryeaxdevdbbr1.rye.avon.com"
make_foreach_func rye-aix-dev-foreach-server $RYE_AIX_DEV_SERVERS
make_ssh_aliases                             $RYE_AIX_DEV_SERVERS

RYE_AIX_QA_SERVERS="
  ryeaxqadbbr1.rye.avon.com
  ryeaxacqappbr1.rye.avon.com
  ryeaxacqappbr2.rye.avon.com"
make_foreach_func rye-aix-qa-foreach-server $RYE_AIX_QA_SERVERS
make_ssh_aliases                            $RYE_AIX_QA_SERVERS
alias ryeaxacqdbbrc="ssh ryeaxacqdbbrc.rye.avon.com"

RYE_AIX_PROD_SERVERS="
  ryeaxacpappbr1.rye.avon.com
  ryeaxacpappbr2.rye.avon.com
  ryeaxacpdbbr1.rye.avon.com
  ryeaxmcpdbbr1.rye.avon.com"
make_foreach_func rye-aix-prod-foreach-server $RYE_AIX_PROD_SERVERS
make_ssh_aliases                              $RYE_AIX_PROD_SERVERS
alias ryeaxacpdbbrc="ssh ryeaxacpdbbrc.rye.avon.com"

RYE_AIX_SERVERS="
  $RYE_AIX_DEV_SERVERS $RYE_AIX_QA_SERVERS $RYE_AIX_PROD_SERVERS"
make_foreach_func rye-aix-foreach-server $RYE_AIX_SERVERS

##############################################################################
#
#  RYE LINUX
#

RYE_LINUX_DEV_SERVERS="
  ryelxdmodceapp1.rye.avon.com"
make_foreach_func rye-linux-dev-foreach-server $RYE_LINUX_DEV_SERVERS
make_ssh_aliases                               $RYE_LINUX_DEV_SERVERS

RYE_LINUX_QA_SERVERS="
  ryelxqwbbrgmc1.rye.avon.com
  ryelxqmodceapp1.rye.avon.com
  ryelxqmodceapp2.rye.avon.com"
make_foreach_func rye-linux-qa-foreach-server $RYE_LINUX_QA_SERVERS
make_ssh_aliases                              $RYE_LINUX_QA_SERVERS

RYE_LINUX_PROD_SERVERS="
  ryelxpwbbrgmc1.rye.avon.com
  ryelxpmodceapp1.rye.avon.com
  ryelxpmodceapp2.rye.avon.com"
make_foreach_func rye-linux-prod-foreach-server $RYE_LINUX_PROD_SERVERS
make_ssh_aliases                                $RYE_LINUX_PROD_SERVERS

RYE_LINUX_SERVERS="
  $RYE_LINUX_DEV_SERVERS $RYE_LINUX_QA_SERVERS $RYE_LINUX_PROD_SERVERS"
make_foreach_func rye-linux-foreach-server $RYE_LINUX_SERVERS

##############################################################################
#
#  BR
#

BR_DEV_SERVERS="$BR_AIX_DEV_SERVERS $BR_LINUX_DEV_SERVERS"
make_foreach_func br-dev-foreach-server $BR_DEV_SERVERS

BR_QA_SERVERS="$BR_AIX_QA_SERVERS $BR_LINUX_QA_SERVERS"
make_foreach_func br-qa-foreach-server $BR_QA_SERVERS

BR_PROD_SERVERS="$BR_AIX_PROD_SERVERS $BR_LINUX_PROD_SERVERS"
make_foreach_func br-prod-foreach-server $BR_PROD_SERVERS

BR_SERVERS="$BR_DEV_SERVERS $BR_QA_SERVERS $BR_PROD_SERVERS"
make_foreach_func br-foreach-server $BR_SERVERS

##############################################################################
#
#  RYE
#

RYE_DEV_SERVERS="$RYE_AIX_DEV_SERVERS $RYE_LINUX_DEV_SERVERS"
make_foreach_func rye-dev-foreach-server $RYE_DEV_SERVERS

RYE_QA_SERVERS="$RYE_AIX_QA_SERVERS $RYE_LINUX_QA_SERVERS"
make_foreach_func rye-qa-foreach-server $RYE_QA_SERVERS

RYE_PROD_SERVERS="$RYE_AIX_PROD_SERVERS $RYE_LINUX_PROD_SERVERS"
make_foreach_func rye-prod-foreach-server $RYE_PROD_SERVERS

RYE_SERVERS="$RYE_DEV_SERVERS $RYE_QA_SERVERS $RYE_PROD_SERVERS"
make_foreach_func rye-foreach-server $RYE_SERVERS

##############################################################################
#
#  AIX, LINUX, ALL
#

AIX_SERVERS="$BR_AIX_SERVERS $RYE_AIX_SERVERS"
make_foreach_func aix-foreach-server $AIX_SERVERS

LINUX_SERVERS="$BR_LINUX_SERVERS $RYE_LINUX_SERVERS"
make_foreach_func linux-foreach-server $LINUX_SERVERS

ALL_SERVERS="$AIX_SERVERS $LINUX_SERVERS"
make_foreach_func all-foreach-server $ALL_SERVERS

##############################################################################

alias spomswasnd="rdesktop -z -g 1024x768 -u alexeiz -d AVONSA -E spomswasnd.sa.avonet.net"
alias spomsclbpm1="rdesktop -z -g 1024x768 -u backup_spo -d AVONSA -E spomsclbpm1"
alias spomsclbpm2="rdesktop -z -g 1024x768 -u backup_spo -d AVONSA -E spomsclbpm2"
alias spomsrepdst="rdesktop -z -g 1024x768 -u backup_spo -d AVONSA -E spomsrepdst"
alias spomonitor="vinagre spomonitor.sa.avonet.net"

